<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jadwal Muadzin Masjid Al-Kautsar FSM</title>
    <style>
      :root {
        --primary-color: #2c5f8b;
        --secondary-color: #4a8bc9;
        --accent-color: #f0c14b;
        --light-color: #f9f9f9;
        --dark-color: #333;
        --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        --deep-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 2rem;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ed 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background-color: white;
        border-radius: 12px;
        box-shadow: var(--deep-shadow);
        padding: 2rem;
        position: relative;
        overflow: hidden;
      }

      .container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 8px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
      }

      h2 {
        text-align: center;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        font-size: 1.8rem;
        position: relative;
        padding-bottom: 10px;
      }

      h2::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 3px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 3px;
      }

      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-top: 1.5rem;
        background-color: white;
        box-shadow: var(--shadow);
        border-radius: 8px;
        overflow: hidden;
      }

      th,
      td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }

      th {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
      }

      th:not(:last-child)::after {
        content: "";
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        height: 60%;
        width: 1px;
        background-color: rgba(255, 255, 255, 0.3);
      }

      tr:hover {
        background-color: rgba(74, 139, 201, 0.05);
        transform: translateY(-1px);
        transition: all 0.2s ease;
      }

      tr:last-child td {
        border-bottom: none;
      }

      .button {
        display: inline-block;
        margin: 1rem 0.5rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: all 0.5s ease;
      }

      .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .button:hover::before {
        left: 100%;
      }

      .button:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .button-container {
        text-align: center;
        margin-top: 2rem;
      }

      .libur {
        text-align: center;
        padding: 2rem;
        color: #777;
        font-size: 1.2rem;
        background-color: #f8f9fa;
        border-radius: 8px;
        margin: 1rem 0;
        box-shadow: var(--shadow);
      }

      /* Countdown to Prayer Time */
      .countdown-container {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1.5rem;
        margin: 1rem 0;
        box-shadow: var(--shadow);
        text-align: center;
      }

      .countdown-title {
        color: var(--primary-color);
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
        font-weight: 600;
      }

      .countdown-subtitle {
        color: #555;
        font-size: 0.9rem;
        margin-bottom: 1rem;
      }

      .countdown-timer {
        font-size: 2rem;
        font-weight: 700;
        color: var(--secondary-color);
        margin: 0.5rem 0;
      }

      .prayer-name {
        font-size: 1.5rem;
        color: var(--primary-color);
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .prayer-time {
        font-size: 1.2rem;
        color: #555;
      }

      /* 3D Button for Jumat */
      .btn-3d {
        position: relative;
        display: inline-block;
        padding: 0.8rem 1.5rem;
        margin: 1rem 0;
        color: white;
        background: linear-gradient(135deg, #4caf50, #2e7d32);
        border: none;
        border-radius: 6px;
        text-align: center;
        text-decoration: none;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        box-shadow: 0 4px 0 #1b5e20, 0 5px 10px rgba(0, 0, 0, 0.2);
        transition: all 0.1s ease;
      }

      .btn-3d:active {
        box-shadow: 0 2px 0 #1b5e20, 0 3px 5px rgba(0, 0, 0, 0.2);
        transform: translateY(4px);
      }

      .btn-3d:hover {
        background: linear-gradient(135deg, #43a047, #2e7d32);
      }

      .btn-container {
        text-align: center;
        margin: 0.5rem 0;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        body {
          padding: 1rem;
        }

        .container {
          padding: 1rem;
        }

        th,
        td {
          padding: 0.75rem;
        }

        .button {
          padding: 0.6rem 1.2rem;
          font-size: 0.9rem;
        }

        .countdown-timer {
          font-size: 1.5rem;
        }

        .prayer-name {
          font-size: 1.2rem;
        }
      }

      /* Animation */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      table,
      .countdown-container {
        animation: fadeIn 0.5s ease-out;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2 id="tanggal"></h2>

      <!-- Countdown to Next Prayer -->
      <div class="countdown-container">
        <div class="countdown-title">Menuju Waktu Sholat Berikutnya</div>
        <div class="prayer-name" id="next-prayer-name">Memuat...</div>
        <div class="prayer-time" id="next-prayer-time"></div>
        <div class="countdown-timer" id="countdown-timer"></div>
      </div>

      <div class="table-container">
        <table id="jadwal-table">
          <thead>
            <tr>
              <th>Waktu</th>
              <th>Nama Petugas</th>
              <th>Prodi</th>
            </tr>
          </thead>
          <tbody id="jadwal-body"></tbody>
        </table>
      </div>

      <!-- 3D Button for Jumat (hidden by default) -->
      <div
        id="jumat-button-container"
        class="btn-container"
        style="display: none"
      >
        <a
          href="https://wahyu1011.github.io/Maswahyu.com/Takmir/templatePengumuman"
          class="btn-3d"
        >
          <i class="fas fa-bullhorn"></i> Template Pengumuman
        </a>
      </div>

      <div id="libur" class="libur" style="display: none">
        <i
          class="fas fa-mosque"
          style="font-size: 2rem; margin-bottom: 0.5rem"
        ></i>
        <div>Libur - Tidak Ada Jadwal</div>
      </div>

      <div class="button-container">
        <button class="button" onclick="goToToday()">
          <i class="fas fa-calendar-day"></i> Hari Ini
        </button>
        <button class="button" onclick="nextDay()">
          <i class="fas fa-arrow-right"></i> Hari Berikut
        </button>
      </div>
    </div>

    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />

    <script>
      // Jadwal Petugas Mingguan (Petugas 1)
      const petugasMingguan = {
        Senin: {
          dzuhur: "Tanu Tanwirul Ramadhan",
          ashar: "Fakhrizain Nahla",
        },
        Selasa: {
          dzuhur: "Misbachul Munir",
          ashar: "Wahyu Eko Setyo Pribowo",
        },
        Rabu: {
          dzuhur: "Salik Bahrudin",
          ashar: "Wahyu Budi Utomo",
        },
        Kamis: {
          dzuhur: "Muhammad Iqbal Maulana",
          ashar: "Salman Farizi",
        },
        Jumat: {
          dzuhur: null,
          ashar: "Wahyu Eko Setyo Pribowo",
        },
      };

      // Jadwal Petugas Minggu ke-2 (Petugas 2)
      const petugasMingguKe2 = {
        Senin: {
          dzuhur: "Ahmad Alifil Ma'luf",
          ashar: "Wahyu Budi Utomo",
        },
        Selasa: {
          dzuhur: "Muhammad Syaroful Anam",
          ashar: "Fakhrizain Nahla",
        },
        Rabu: {
          dzuhur: "Salman Farizi",
          ashar: "Salik Bahrudin",
        },
        Kamis: {
          dzuhur: "Fakhrizain Nahla",
          ashar: "Muhammad Iqbal Maulana",
        },
        Jumat: {
          dzuhur: null,
          ashar: "Fakhrizain Nahla",
        },
      };

      // Jadwal petugas Jumat Dzuhur bergantian setiap minggu
      const petugasJumatDzuhur = [
        { petugas1: "Wahyu Budi Utomo", petugas2: "Salik Bahrudin" },
        { petugas1: "Wahyu Eko Setyo Pribowo", petugas2: "Fakhrizain Nahla" },
        {
          petugas1: "Tanu Tanwirul Ramadhan",
          petugas2: "Muhammad Syaroful Anam",
        },
        { petugas1: "Misbachul Munir", petugas2: "Salman Farizi" },
        { petugas1: "Muhammad Iqbal Maulana", petugas2: "Ahmad Alifil Ma'luf" },
      ];

      // Data prodi petugas
      const prodi = {
        "Tanu Tanwirul Ramadhan": "Matematika 24",
        "Ahmad Alifil Ma'luf": "Fisika 24",
        "Misbachul Munir": "Informatika 24",
        "Muhammad Syaroful Anam": "Matematika 24",
        "Salik Bahrudin": "Kimia 24",
        "Salman Farizi": "Fisika 23",
        "Muhammad Iqbal Maulana": "Matematika 25",
        "Fakhrizain Nahla": "Biologi 25",
        "Wahyu Budi Utomo": "Fisika 22",
        "Wahyu Eko Setyo Pribowo": "Informatika 24",
      };

      // Urutan sholat untuk menentukan sholat berikutnya
      const prayerOrder = ["subuh", "dzuhur", "ashar", "maghrib", "isya"];

      // Variabel untuk menyimpan jadwal sholat
      let prayerTimes = {};
      let prayerTimesDate = "";
      let countdownInterval;

      // Urutan hari
      const days = [
        "Minggu",
        "Senin",
        "Selasa",
        "Rabu",
        "Kamis",
        "Jumat",
        "Sabtu",
      ];

      // Variabel untuk menyimpan tanggal saat ini dan indeks navigasi
      let today = new Date();
      let currentDate = new Date(today);
      let currentIndex = 0;

      // Fungsi untuk mengambil jadwal sholat dari NU Online
      async function fetchPrayerTimes() {
        try {
          const today = new Date();
          const year = today.getFullYear();
          const month = today.getMonth() + 1;
          const day = today.getDate();

          // Format tanggal untuk NU Online (YYYY-MM-DD)
          const formattedDate = `${year}-${month
            .toString()
            .padStart(2, "0")}-${day.toString().padStart(2, "0")}`;

          // ID Kota Semarang di NU Online
          const cityId = "641"; // ID untuk Semarang

          const response = await fetch(
            `https://jadwalsholat.nu.or.id/?id=${cityId}&t=${formattedDate}`,
            {
              mode: "no-cors", // Ini mungkin tidak cukup, mungkin perlu proxy server
            }
          );

          // Karena CORS mungkin bermasalah, kita gunakan pendekatan alternatif
          // Untuk demo, kita akan gunakan data contoh
          // Dalam implementasi nyata, Anda perlu:
          // 1. Buat endpoint proxy di server Anda sendiri
          // 2. Atau gunakan API lain yang mendukung CORS

          // Data contoh untuk Tembalang, Semarang
          const exampleTimes = {
            subuh: "04:30",
            dzuhur: "11:37",
            ashar: "14:58",
            maghrib: "17:45",
            isya: "19:00",
          };

          // Simpan tanggal hari ini
          prayerTimesDate = formattedDate;
          prayerTimes = exampleTimes;

          // Mulai countdown
          startCountdown();

          // Jika ingin implementasi nyata, uncomment berikut dan sesuaikan dengan endpoint proxy Anda:
          /*
          const proxyResponse = await fetch(`/api/prayer-times?date=${formattedDate}`);
          const data = await proxyResponse.json();
          prayerTimes = {
            subuh: data.subuh,
            dzuhur: data.dzuhur,
            ashar: data.ashar,
            maghrib: data.maghrib,
            isya: data.isya
          };
          prayerTimesDate = formattedDate;
          startCountdown();
          */
        } catch (error) {
          console.error("Gagal mengambil jadwal sholat:", error);
          // Fallback ke data contoh jika gagal
          prayerTimes = {
            subuh: "04:30",
            dzuhur: "11:45",
            ashar: "15:10",
            maghrib: "17:45",
            isya: "19:00",
          };
          startCountdown();
        }
      }

      // Fungsi untuk memulai countdown ke waktu sholat berikutnya
      function startCountdown() {
        // Hentikan interval sebelumnya jika ada
        if (countdownInterval) {
          clearInterval(countdownInterval);
        }

        // Dapatkan waktu sekarang
        const now = new Date();
        const currentHours = now.getHours();
        const currentMinutes = now.getMinutes();
        const currentTimeInMinutes = currentHours * 60 + currentMinutes;

        // Temukan sholat berikutnya
        let nextPrayer = null;
        let nextPrayerTime = null;

        for (const prayer of prayerOrder) {
          if (prayerTimes[prayer]) {
            const [hours, minutes] = prayerTimes[prayer].split(":").map(Number);
            const prayerTimeInMinutes = hours * 60 + minutes;

            // Jika waktu sholat belum lewat hari ini
            if (prayerTimeInMinutes > currentTimeInMinutes) {
              nextPrayer = prayer;
              nextPrayerTime = prayerTimes[prayer];
              break;
            }
          }
        }

        // Jika tidak ada sholat berikutnya hari ini, ambil subuh besok
        if (!nextPrayer) {
          nextPrayer = "subuh";
          nextPrayerTime = prayerTimes.subuh;

          // Tambahkan 1 hari ke waktu sholat
          const tomorrow = new Date(now);
          tomorrow.setDate(tomorrow.getDate() + 1);
        }

        // Update tampilan
        updateNextPrayerDisplay(nextPrayer, nextPrayerTime);

        // Mulai countdown
        countdownInterval = setInterval(() => {
          updateCountdown(nextPrayer, nextPrayerTime);
        }, 1000);
      }

      // Fungsi untuk mengupdate tampilan sholat berikutnya
      function updateNextPrayerDisplay(prayerName, prayerTime) {
        const prayerNames = {
          subuh: "Subuh",
          dzuhur: "Dzuhur",
          ashar: "Ashar",
          maghrib: "Maghrib",
          isya: "Isya",
        };

        document.getElementById("next-prayer-name").textContent =
          prayerNames[prayerName] || prayerName;
        document.getElementById(
          "next-prayer-time"
        ).textContent = `Pukul ${prayerTime}`;
      }

      // Fungsi untuk mengupdate countdown
      function updateCountdown(prayerName, prayerTime) {
        const now = new Date();
        const [hours, minutes] = prayerTime.split(":").map(Number);

        // Buat objek Date untuk waktu sholat
        const prayerDate = new Date();
        prayerDate.setHours(hours, minutes, 0, 0);

        // Jika waktu sholat sudah lewat hari ini, set untuk besok
        if (prayerDate < now) {
          prayerDate.setDate(prayerDate.getDate() + 1);
        }

        // Hitung selisih waktu
        const diff = prayerDate - now;

        if (diff <= 0) {
          // Waktu sholat telah tiba
          document.getElementById("countdown-timer").textContent =
            "Waktu sholat telah tiba!";
          // Ambil jadwal baru
          fetchPrayerTimes();
          return;
        }

        // Konversi selisih ke jam, menit, detik
        const hoursLeft = Math.floor(diff / (1000 * 60 * 60));
        const minutesLeft = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const secondsLeft = Math.floor((diff % (1000 * 60)) / 1000);

        // Format tampilan
        const formattedTime = `${hoursLeft
          .toString()
          .padStart(2, "0")}:${minutesLeft
          .toString()
          .padStart(2, "0")}:${secondsLeft.toString().padStart(2, "0")}`;
        document.getElementById("countdown-timer").textContent = formattedTime;
      }

      // Fungsi untuk menginisialisasi tampilan pertama kali
      function initialize() {
        // Set currentDate ke hari ini
        currentDate = new Date(today);

        // Hitung hari dalam seminggu (0=Minggu, 1=Senin, ..., 6=Sabtu)
        const dayOfWeek = today.getDay();

        // Jika hari Minggu atau Sabtu, mulai dari Senin berikutnya
        if (dayOfWeek === 0 || dayOfWeek === 6) {
          const daysToAdd = dayOfWeek === 0 ? 1 : 2;
          currentDate.setDate(today.getDate() + daysToAdd);
        }

        // Ambil jadwal sholat
        fetchPrayerTimes();

        updateTable();
      }

      // Fungsi untuk memperbarui tabel
      function updateTable() {
        const hari = days[currentDate.getDay()];
        const tanggal = currentDate.toLocaleDateString("id-ID", {
          day: "numeric",
          month: "long",
          year: "numeric",
        });

        // Update tanggal di header
        document.getElementById("tanggal").textContent = hari + ", " + tanggal;

        // Tampilkan atau sembunyikan button Jumat
        const jumatButton = document.getElementById("jumat-button-container");
        jumatButton.style.display = hari === "Jumat" ? "block" : "none";

        const tbody = document.getElementById("jadwal-body");
        tbody.innerHTML = "";
        document.getElementById("libur").style.display = "none";

        if (hari === "Minggu" || hari === "Sabtu") {
          // Hari libur
          document.getElementById("libur").style.display = "block";
          return;
        }

        // Hitung minggu ke berapa sejak tanggal awal (16 Mei 2025)
        const baseDate = new Date(2025, 4, 16); // 16 Mei 2025
        const diffTime = currentDate - baseDate;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        const mingguKe = Math.floor(diffDays / 7);

        // Minggu ganjil = minggu ke-1 petugas 1, minggu genap = minggu ke-2 petugas 2
        const jadwal = mingguKe % 2 === 0 ? petugasMingguan : petugasMingguKe2;

        ["dzuhur", "ashar"].forEach((waktu) => {
          if (hari === "Jumat" && waktu === "dzuhur") {
            // Khusus Jumat Dzuhur, ambil petugas sesuai minggu ke berapa
            const jumatIndex = mingguKe % petugasJumatDzuhur.length;
            const petugas = petugasJumatDzuhur[jumatIndex];

            // Tampilkan petugas 1
            const row1 = document.createElement("tr");

            const cellWaktu1 = document.createElement("td");
            cellWaktu1.textContent = "Dzuhur";
            row1.appendChild(cellWaktu1);

            const cellNama1 = document.createElement("td");
            cellNama1.textContent = petugas.petugas1;
            row1.appendChild(cellNama1);

            const cellProdi1 = document.createElement("td");
            cellProdi1.textContent = prodi[petugas.petugas1] || "-";
            row1.appendChild(cellProdi1);

            tbody.appendChild(row1);

            // Tampilkan petugas 2
            const row2 = document.createElement("tr");

            const cellWaktu2 = document.createElement("td");
            cellWaktu2.textContent = "";
            row2.appendChild(cellWaktu2);

            const cellNama2 = document.createElement("td");
            cellNama2.textContent = petugas.petugas2;
            row2.appendChild(cellNama2);

            const cellProdi2 = document.createElement("td");
            cellProdi2.textContent = prodi[petugas.petugas2] || "-";
            row2.appendChild(cellProdi2);

            tbody.appendChild(row2);
          } else {
            const namaPetugas = jadwal[hari][waktu];
            if (namaPetugas) {
              const row = document.createElement("tr");

              const cellWaktu = document.createElement("td");
              cellWaktu.textContent =
                waktu.charAt(0).toUpperCase() + waktu.slice(1);
              row.appendChild(cellWaktu);

              const cellNama = document.createElement("td");
              cellNama.textContent = namaPetugas;
              row.appendChild(cellNama);

              const cellProdi = document.createElement("td");
              cellProdi.textContent = prodi[namaPetugas] || "-";
              row.appendChild(cellProdi);

              tbody.appendChild(row);
            }
          }
        });
      }

      // Fungsi untuk pindah ke hari berikutnya
      function nextDay() {
        currentDate.setDate(currentDate.getDate() + 1);
        updateTable();
      }

      // Fungsi untuk kembali ke hari ini
      function goToToday() {
        currentDate = new Date(today);
        updateTable();
      }

      // Inisialisasi saat halaman dimuat
      window.onload = initialize;
    </script>
  </body>
</html>
