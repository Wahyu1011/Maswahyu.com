<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Informasi Keuangan - Musholla Annur</title>
    <style>
      :root {
        --primary: #26a69a;
        --background: #e0f7fa;
        --card: #ffffffdd;
        --text: #2c3e50;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 30px;
        background: linear-gradient(to right, #e0f2f1, #e8f5e9);
        color: var(--text);
      }

      h1 {
        text-align: center;
        color: var(--primary);
        margin-bottom: 10px;
        font-size: 32px;
      }

      .subtitle {
        text-align: center;
        font-size: 16px;
        color: #607d8b;
        margin-top: -8px;
        margin-bottom: 30px;
      }

      .summary {
        max-width: 500px;
        margin: 0 auto 30px auto;
        background-color: var(--card);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        text-align: center;
        font-size: 18px;
      }

      .summary strong {
        color: #1b5e20;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background-color: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
      }

      th,
      td {
        padding: 14px;
        text-align: center;
        border: 1px solid #e0e0e0;
        font-size: 16px;
      }

      th {
        background-color: var(--primary);
        color: white;
        font-weight: bold;
      }

      tr:nth-child(even) td {
        background-color: #f8f8f8;
      }

      tr:hover td {
        background-color: #e0f2f1;
        transition: background-color 0.2s ease;
      }

      .footer {
        text-align: center;
        margin-top: 50px;
        font-size: 14px;
        color: #78909c;
      }
    </style>
  </head>
  <body>
    <h1>üí∞ Keuangan Musholla Annur</h1>
    <p class="subtitle">Uang Jama'ah Ahad Pagi</p>

    <div class="summary">
      <strong>Total pemasukan:</strong> <span id="total">Rp. 0</span>
    </div>

    <table id="data">
      <!-- Tabel akan diisi dari localStorage -->
    </table>

    <p class="footer">üìå Data ini bersumber dari Admin.</p>

    <script>
      const table = document.getElementById("data");

      function loadTable() {
        const savedData = localStorage.getItem("tableData");
        if (savedData) {
          table.innerHTML = savedData;
          bersihkanTombol();
          updateTotal();
        } else {
          table.innerHTML =
            "<tr><td colspan='100%'>Data belum tersedia. Silakan hubungi admin.</td></tr>";
        }
      }

      function bersihkanTombol() {
        const buttons = table.querySelectorAll(".delete-btn");
        buttons.forEach((btn) => btn.remove());
      }

      function updateTotal() {
        let total = 0;
        const rows = table.querySelectorAll("tbody tr");
        rows.forEach((row) => {
          for (let i = 2; i < row.cells.length; i++) {
            const nilai = row.cells[i].textContent.trim().replace("x", "");
            if (nilai && !isNaN(nilai)) {
              total += parseInt(nilai);
            }
          }
        });
        document.getElementById("total").textContent =
          "Rp. " + total.toLocaleString("id-ID");
      }

      loadTable();
    </script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        get,
        child,
      } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCuSe6S91ZzV7PMV9EeUW3bRaAf_P8QkZo",
        authDomain: "maswahyu-86655.firebaseapp.com",
        databaseURL: "https://maswahyu-86655-default-rtdb.firebaseio.com",
        projectId: "maswahyu-86655",
        storageBucket: "maswahyu-86655.appspot.com",
        messagingSenderId: "343863883612",
        appId: "1:343863883612:web:283d349edb0e251bf2f399",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      // Fungsi untuk ambil data dari Firebase
      async function loadFromFirebase() {
        try {
          const snapshot = await get(child(ref(db), "keuangan/tabel"));
          if (snapshot.exists()) {
            const htmlTable = snapshot.val().html;
            document.getElementById("data").innerHTML = htmlTable;
            bersihkanTombol();
            updateTotal();
            console.log("‚úÖ Data berhasil dimuat dari Firebase.");
          } else {
            table.innerHTML =
              "<tr><td colspan='100%'>Data belum tersedia di Firebase.</td></tr>";
          }
        } catch (error) {
          console.error("‚ùå Gagal mengambil data dari Firebase:", error);
          table.innerHTML =
            "<tr><td colspan='100%'>Gagal mengambil data. Silakan coba lagi.</td></tr>";
        }
      }

      // Load saat halaman dibuka
      loadFromFirebase();
    </script>
  </body>
</html>
