
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prediksi NIK</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f9f9f9;
      margin: 0;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    select, input, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      background: teal;
      color: white;
      font-weight: bold;
      border: none;
      margin-top: 20px;
      cursor: pointer;
    }
    #hasilNIK, #hasilDetil {
      text-align: center;
      margin-top: 20px;
      font-weight: bold;
      color: #333;
    }
    @media (max-width: 600px) {
      form {
        padding: 15px;
      }
      select, input, button {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <form id="formNIK">
    <h2>Prediksi NIK</h2>

    <label>Provinsi:</label>
    <select id="provinsi" required></select>

    <label>Kabupaten/Kota:</label>
    <select id="kabkot" required></select>

    <label>Kecamatan:</label>
    <select id="kecamatan" required></select>

    <label>Tanggal Lahir:</label>
    <input type="date" id="tanggalLahir" required>

    <label>Jenis Kelamin:</label>
    <select id="jenisKelamin" required>
      <option value="L">Laki-laki</option>
      <option value="P">Perempuan</option>
    </select>

    <button type="submit">Cek NIK</button>
    <p id="hasilNIK"></p>
  </form>

  <hr style="margin: 40px 0">

  <form id="cekDariNIK">
    <h2>Cek Data dari NIK</h2>

    <label>Masukkan NIK:</label>
    <input type="text" id="inputNIK" maxlength="16" required>

    <button type="submit">Cek</button>

    <div id="hasilDetil"></div>
  </form>

  <script>
    let data;

    fetch('data-provinsi.json')
      .then(res => res.json())
      .then(json => {
        data = json;
        const provinsiSelect = document.getElementById('provinsi');
        const kabkotSelect = document.getElementById('kabkot');
        const kecamatanSelect = document.getElementById('kecamatan');

        for (let kode in data.provinsi) {
          let opt = document.createElement('option');
          opt.value = kode;
          opt.textContent = data.provinsi[kode];
          provinsiSelect.appendChild(opt);
        }

        provinsiSelect.addEventListener('change', () => {
          const kodeProv = provinsiSelect.value;
          kabkotSelect.innerHTML = '<option value="">-- Pilih Kab/Kota --</option>';
          kecamatanSelect.innerHTML = '<option value="">-- Pilih Kecamatan --</option>';

          for (let kode in data.kabkot) {
            if (kode.startsWith(kodeProv)) {
              let opt = document.createElement('option');
              opt.value = kode;
              opt.textContent = data.kabkot[kode];
              kabkotSelect.appendChild(opt);
            }
          }
        });

        kabkotSelect.addEventListener('change', () => {
          const kodeKabkot = kabkotSelect.value;
          kecamatanSelect.innerHTML = '<option value="">-- Pilih Kecamatan --</option>';

          for (let kode in data.kecamatan) {
            if (kode.startsWith(kodeKabkot)) {
              let opt = document.createElement('option');
              opt.value = kode;
              opt.textContent = data.kecamatan[kode];
              kecamatanSelect.appendChild(opt);
            }
          }
        });
      });

    document.getElementById('formNIK').addEventListener('submit', function(e) {
      e.preventDefault();

      const kecamatan = document.getElementById('kecamatan').value;
      const tanggalLahir = new Date(document.getElementById('tanggalLahir').value);
      const jenisKelamin = document.getElementById('jenisKelamin').value;

      let tanggal = tanggalLahir.getDate();
      if (jenisKelamin === 'P') tanggal += 40;

      const dd = String(tanggal).padStart(2, '0');
      const mm = String(tanggalLahir.getMonth() + 1).padStart(2, '0');
      const yy = String(tanggalLahir.getFullYear()).slice(-2);

      const nik = kecamatan + dd + mm + yy + "XXXX";
      document.getElementById("hasilNIK").textContent = "Perkiraan NIK: " + nik;
    });

    document.getElementById('cekDariNIK').addEventListener('submit', function(e) {
      e.preventDefault();

      const nik = document.getElementById('inputNIK').value.trim();
      const hasilDiv = document.getElementById('hasilDetil');
      hasilDiv.innerHTML = '';

      if (nik.length !== 16 || isNaN(nik)) {
        hasilDiv.innerHTML = '<p style="color:red;">NIK harus 16 digit angka</p>';
        return;
      }

      const kodeKecamatan = nik.substring(0,6);
      const tgl = parseInt(nik.substring(6,8));
      const bln = parseInt(nik.substring(8,10));
      const thn = parseInt(nik.substring(10,12));

      const jenisKelamin = tgl > 40 ? 'Perempuan' : 'Laki-laki';
      const tahunFix = thn > 30 ? 1900 + thn : 2000 + thn;
      const tanggalFix = tgl > 40 ? tgl - 40 : tgl;
      const tanggalLahir = new Date(tahunFix, bln - 1, tanggalFix);

      const prov = kodeKecamatan.substring(0,2);
      const kab = kodeKecamatan.substring(0,4);

      const provinsi = data.provinsi[prov] || 'Tidak ditemukan';
      const kabkot = data.kabkot[kab] || 'Tidak ditemukan';
      const kecamatan = data.kecamatan[kodeKecamatan] || 'Tidak ditemukan';
      const indexAkhir = nik.substring(12); // 4 digit terakhir

      hasilDiv.innerHTML = `
        <p><strong>Provinsi:</strong> ${provinsi}</p>
        <p><strong>Kabupaten/Kota:</strong> ${kabkot}</p>
        <p><strong>Kecamatan:</strong> ${kecamatan}</p>
        <p><strong>Tanggal Lahir:</strong> ${tanggalLahir.toLocaleDateString('id-ID')}</p>
        <p><strong>Jenis Kelamin:</strong> ${jenisKelamin}</p>
        <p><strong>Index:</strong> ${indexAkhir}</p>
      `;
    });
  </script>
</body>
</html>
